generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum SessionStatus {
  active
  archived
}

model Session {
  id           String        @id @default(cuid())
  name         String
  slug         String        @unique
  teacherName  String        @map("teacher_name")
  teacherEmail String        @map("teacher_email")
  teacherClass String        @map("teacher_class")
  status       SessionStatus @default(active)
  createdAt    DateTime      @default(now()) @map("created_at")
  updatedAt    DateTime      @updatedAt @map("updated_at")

  slots Slot[]

  @@index([status])
  @@map("sessions")
}

model Slot {
  id        String   @id @default(cuid())
  sessionId String   @map("session_id")
  date      DateTime @db.Date
  startTime String   @map("start_time")
  endTime   String   @map("end_time")
  isBooked  Boolean  @default(false) @map("is_booked")
  createdAt DateTime @default(now()) @map("created_at")

  session Session  @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  booking Booking?

  @@unique([sessionId, date, startTime])
  @@index([sessionId])
  @@index([date])
  @@map("slots")
}

model Booking {
  id             String   @id @default(cuid())
  slotId         String   @unique @map("slot_id")
  parentName     String   @map("parent_name")
  childFirstname String   @map("child_firstname")
  email          String?
  comment        String?
  reminderSent   Boolean  @default(false) @map("reminder_sent")
  createdAt      DateTime @default(now()) @map("created_at")

  slot Slot @relation(fields: [slotId], references: [id], onDelete: Cascade)

  @@index([reminderSent])
  @@map("bookings")
}
